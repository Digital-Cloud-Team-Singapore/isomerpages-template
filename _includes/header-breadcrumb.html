<nav class="bp-breadcrumb" aria-label="breadcrumbs">
    <ul>
        <li><a href="{{- site.baseurl -}}/"><small>{{- "Home" | upcase -}}</small></a></li>
        {%- capture page_url_without_index_html -%}{{- page.url | remove: "/index.html" -}}{%- endcapture -%} <!-- page.url: {{ page.url }} --> <!-- page_url_without_index_html: {{ page_url_without_index_html }} -->
        {%- assign splitted_url_parts = page_url_without_index_html | split: '/' -%} <!-- splitted_url_parts: {{ splitted_url_parts }} -->
        {%- capture forLoopMaxInt -%}{{- splitted_url_parts.size | minus:1 -}}{%- endcapture -%} <!-- forLoopMaxInt: {{ forLoopMaxInt }} -->
        {%- for i in (1..forLoopMaxInt) -%}
            {%- capture current_breadcrumb_url -%}{{next_prepender}}/{{- splitted_url_parts[i] -}}/index.html{%- endcapture -%} <!-- current_breadcrumb_url: {{ current_breadcrumb_url }} -->
            {%- capture current_breadcrumb_md_url -%}{{next_prepender}}/{{- splitted_url_parts[i] -}}/{%- endcapture -%} <!-- current_breadcrumb_md_url: {{ current_breadcrumb_md_url }} -->
            {%- capture next_prepender -%}{{next_prepender}}/{{- splitted_url_parts[i] -}}{%- endcapture -%} <!-- next_prepender: {{ next_prepender }} -->
            {%- for breadcrumb_page in site.pages -%}
                <!-- breadcrumb_page: {{ breadcrumb_page }} -->
                {%- if current_breadcrumb_url == breadcrumb_page.permalink or current_breadcrumb_md_url == breadcrumb_page.permalink -%}
                    <!-- in case 1, current_breadcrumb_url: {{ current_breadcrumb_url }} -->
                    <li><a href="{{- site.baseurl -}}{{breadcrumb_page.permalink}}"><small>{{breadcrumb_page.breadcrumb | upcase}}</small></a></li>
                {%- endif -%}
                {%- comment -%} Special case for the media index.html since the media page is paginated and cannot have a permalink {%- endcomment -%}
                {%- if current_breadcrumb_url == breadcrumb_page.file_url or current_breadcrumb_md_url == breadcrumb_page.file_url -%}
                    {%- comment -%} prevent repetition of paginated pages {%- endcomment -%}
                    <!-- in case 2, breadcrumb_page.file_url: {{ breadcrumb_page.file_url }} -->
                    {%- unless breadcrumb_page.url contains 'page' -%}
                        <!-- in case 3 -->
                        <li><a href="{{- site.baseurl -}}{{breadcrumb_page.file_url}}"><small>{{breadcrumb_page.breadcrumb | upcase}}</small></a></li>
                    {%- endunless -%}
                {%- endif -%}
            {%- endfor -%}
            {%- comment -%} Repeat for collections {%- endcomment -%}
            {%- for collection in site.collections -%}
                <!-- collection: {{ collection }} -->
                {%- for breadcrumb_page in collection.docs -%}
                    {%- if current_breadcrumb_url == breadcrumb_page.permalink or current_breadcrumb_md_url == breadcrumb_page.permalink  -%}
                        <!-- in case 4, breadcrumb_page.permalink: {{ breadcrumb_page.permalink }} -->
                        <li><a href="{{- site.baseurl -}}{{breadcrumb_page.permalink}}"><small>{{breadcrumb_page.breadcrumb | upcase}}</small></a></li>
                    {%- endif -%}
                {%- endfor -%}
            {%- endfor -%}
        {%- endfor -%}
    </ul>
</nav>